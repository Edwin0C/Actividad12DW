<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - L√ºmenik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/estilos.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body class="bg-gray-900 text-gray-100">
    <div id="admin-app" class="min-h-screen">
        <!-- Barra Superior -->
        <nav class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                    L√úMENIK ADMIN
                </h1>
                <div class="flex items-center space-x-4">
                    <span id="usuario-nombre" class="text-purple-400 font-semibold"></span>
                    <button id="logout-btn" class="px-4 py-2 bg-red-600 rounded hover:bg-red-700 transition">
                        Salir
                    </button>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-4 py-8">
            <!-- Estad√≠sticas - Cuadros Interactivos -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
                <!-- Cuadro Usuarios -->
                <div class="stat-card cursor-pointer bg-gradient-to-br from-blue-900 to-blue-800 rounded-lg p-6 shadow-lg hover:shadow-2xl hover:from-blue-800 hover:to-blue-700 transition-all duration-300 transform hover:scale-105" 
                     onclick="cambiarTab('usuarios')" data-tab="usuarios">
                    <div class="stat-content">
                        <p class="text-gray-300 text-sm font-semibold mb-2 stat-label">Total Usuarios</p>
                        <p class="text-4xl font-bold text-blue-200" id="stat-usuarios">0</p>
                    </div>
                    <div class="stat-hover">
                        <p class="text-lg font-bold text-white">üë• Gestionar Usuarios</p>
                    </div>
                </div>

                <!-- Cuadro Juegos -->
                <div class="stat-card cursor-pointer bg-gradient-to-br from-green-900 to-green-800 rounded-lg p-6 shadow-lg hover:shadow-2xl hover:from-green-800 hover:to-green-700 transition-all duration-300 transform hover:scale-105" 
                     onclick="cambiarTab('juegos')" data-tab="juegos">
                    <div class="stat-content">
                        <p class="text-gray-300 text-sm font-semibold mb-2 stat-label">Total Juegos</p>
                        <p class="text-4xl font-bold text-green-200" id="stat-juegos">0</p>
                    </div>
                    <div class="stat-hover">
                        <p class="text-lg font-bold text-white">üéÆ Gestionar Juegos</p>
                    </div>
                </div>

                <!-- Cuadro Trabajos -->
                <div class="stat-card cursor-pointer bg-gradient-to-br from-purple-900 to-purple-800 rounded-lg p-6 shadow-lg hover:shadow-2xl hover:from-purple-800 hover:to-purple-700 transition-all duration-300 transform hover:scale-105" 
                     onclick="cambiarTab('trabajos')" data-tab="trabajos">
                    <div class="stat-content">
                        <p class="text-gray-300 text-sm font-semibold mb-2 stat-label">Trabajos Completados</p>
                        <p class="text-4xl font-bold text-purple-200" id="stat-trabajos">0</p>
                    </div>
                    <div class="stat-hover">
                        <p class="text-lg font-bold text-white">üìä Historial de Trabajos</p>
                    </div>
                </div>

                <!-- Cuadro Facturaci√≥n -->
                <div class="stat-card cursor-pointer bg-gradient-to-br from-pink-900 to-pink-800 rounded-lg p-6 shadow-lg hover:shadow-2xl hover:from-pink-800 hover:to-pink-700 transition-all duration-300 transform hover:scale-105" 
                     onclick="cambiarTab('trabajos')" data-tab="facturacion">
                    <div class="stat-content">
                        <p class="text-gray-300 text-sm font-semibold mb-2 stat-label">üí∞ Facturaci√≥n</p>
                    </div>
                    <div class="stat-hover">
                        <p class="text-lg font-bold text-white">üí≥ Historial de Facturaci√≥n</p>
                    </div>
                </div>
            </div>

            <!-- Tabs de Navegaci√≥n - Ocultos, se navega por los cuadros -->
            <div class="hidden flex gap-4 mb-8 border-b border-gray-700 overflow-x-auto">
                <button class="tab-btn py-2 px-4 font-bold border-b-2 border-transparent hover:border-purple-500 transition whitespace-nowrap" data-tab="usuarios">
                    Gesti√≥n de Usuarios
                </button>
                <button class="tab-btn py-2 px-4 font-bold border-b-2 border-transparent hover:border-purple-500 transition whitespace-nowrap" data-tab="juegos">
                    Gesti√≥n de Juegos
                </button>
                <button class="tab-btn py-2 px-4 font-bold border-b-2 border-transparent hover:border-purple-500 transition whitespace-nowrap" data-tab="trabajos">
                    Historial de Trabajos
                </button>
            </div>

            <!-- TAB: Gesti√≥n de Usuarios -->
            <div id="usuarios-tab" class="tab-content">
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">Gesti√≥n de Usuarios</h2>
                        <button id="btn-crear-usuario" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded font-bold hover:from-purple-700 hover:to-pink-700 transition">
                            + Crear Usuario
                        </button>
                    </div>

                    <!-- Filtros y B√∫squeda -->
                    <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">üîç Buscar Usuario</label>
                            <input type="text" id="buscar-usuario" placeholder="Por nombre o usuario..." class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm focus:outline-none focus:border-purple-500">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">üìã Ordenar por Nombre</label>
                            <select id="filtro-orden-nombre" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm">
                                <option value="">Sin ordenar</option>
                                <option value="asc">A - Z (Ascendente)</option>
                                <option value="desc">Z - A (Descendente)</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">üü¢ Filtrar por Estado</label>
                            <select id="filtro-estado-usuario" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm">
                                <option value="">Todos</option>
                                <option value="activo">Activo</option>
                                <option value="inactivo">Inactivo</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-limpiar-filtros" class="w-full px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded text-sm font-bold transition">
                                üîÑ Limpiar Filtros
                            </button>
                        </div>
                    </div>

                    <div id="usuarios-lista" class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="px-4 py-2">Usuario</th>
                                    <th class="px-4 py-2">Nombre</th>
                                    <th class="px-4 py-2">Email</th>
                                    <th class="px-4 py-2">Rol</th>
                                    <th class="px-4 py-2">Estado</th>
                                    <th class="px-4 py-2">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usuarios-tbody" class="divide-y divide-gray-700">
                                <!-- Los usuarios se cargar√°n aqu√≠ -->
                            </tbody>
                        </table>
                    </div>
                    <p id="usuarios-contador" class="text-xs text-gray-400 mt-4 text-right">Mostrando 0 usuarios</p>
                </div>
            </div>

            <!-- TAB: Gesti√≥n de Juegos -->
            <div id="juegos-tab" class="tab-content hidden">
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Gesti√≥n de Juegos</h2>
                        <button id="btn-crear-juego" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded font-bold hover:from-purple-700 hover:to-pink-700 transition">
                            + Agregar Juego
                        </button>
                    </div>

                    <!-- Filtros y b√∫squeda de juegos -->
                    <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">üîç Buscar Juego</label>
                            <input type="text" id="buscar-juego-admin" placeholder="Por nombre..." class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm focus:outline-none focus:border-purple-500">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">üéÆ Filtrar por Consola</label>
                            <select id="filtro-consola-juego" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm">
                                <option value="">Todas</option>
                                <option value="PSP">PSP</option>
                                <option value="PS2">PS2</option>
                                <option value="PS3">PS3</option>
                                <option value="PS4">PS4</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-limpiar-filtros-juegos" class="w-full px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded text-sm font-bold transition">
                                üîÑ Limpiar Filtros
                            </button>
                        </div>
                    </div>

                    <!-- Grid de juegos -->
                    <div id="juegos-lista" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <!-- Los juegos se cargar√°n aqu√≠ -->
                    </div>

                    <!-- Paginaci√≥n -->
                    <div id="paginacion-juegos" class="flex justify-center items-center gap-2 mt-6">
                        <button id="btn-pagina-anterior" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm font-bold transition">
                            ‚Üê Anterior
                        </button>
                        <span id="info-paginacion" class="text-gray-300 text-sm font-bold">P√°gina 1</span>
                        <button id="btn-pagina-siguiente" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm font-bold transition">
                            Siguiente ‚Üí
                        </button>
                    </div>
                    <p id="juegos-contador" class="text-xs text-gray-400 mt-4 text-center">Mostrando 0 juegos</p>
                </div>
            </div>

            <!-- TAB: Historial de Trabajos -->
            <div id="trabajos-tab" class="tab-content hidden">
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h2 class="text-2xl font-bold">Historial de Trabajos</h2>
                            <p class="text-sm text-gray-400 mt-1">Todos los trabajos solicitados por clientes</p>
                        </div>
                        <button id="btn-refrescar-trabajos" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded font-bold text-sm transition">
                            üîÑ Refrescar
                        </button>
                    </div>
                    
                    <!-- Filtros -->
                    <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Filtrar por Estado</label>
                            <select id="filtro-estado" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm">
                                <option value="">Todos los estados</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="en_progreso">En Proceso</option>
                                <option value="completado">Completado</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Filtrar por Tipo</label>
                            <select id="filtro-tipo" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm">
                                <option value="">Todos los tipos</option>
                                <option value="instalacion">Instalaci√≥n</option>
                                <option value="descarga">Descarga</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 mb-1 block">Buscar por Cliente</label>
                            <input type="text" id="buscar-cliente" placeholder="Nombre o email..." class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm">
                        </div>
                    </div>
                    
                    <div id="trabajos-lista" class="space-y-4">
                        <!-- El historial se cargar√° aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Crear/Editar Usuario -->
        <div id="modal-usuario" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <h3 id="modal-usuario-titulo" class="text-2xl font-bold mb-6">Crear Nuevo Usuario</h3>
                <form id="form-usuario" class="space-y-5">
                    <input type="hidden" id="form-usuario-id">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üë§ Nombre de Usuario</label>
                        <input type="text" id="form-usuario-nombre" placeholder="ej: cesar_123" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-purple-500" required>
                        <p class="text-xs text-gray-400 mt-1">Nombre √∫nico para iniciar sesi√≥n</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üìß Correo Electr√≥nico</label>
                        <input type="email" id="form-usuario-email" placeholder="ej: cesar@lumenik.com" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-purple-500" required>
                        <p class="text-xs text-gray-400 mt-1">Email v√°lido para notificaciones</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üîí Contrase√±a</label>
                        <input type="password" id="form-usuario-contrase√±a" placeholder="M√≠nimo 6 caracteres" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-purple-500">
                        <p class="text-xs text-gray-400 mt-1">Dejar en blanco para no cambiar (en edici√≥n)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üìù Nombre Completo</label>
                        <input type="text" id="form-usuario-nombre-completo" placeholder="ej: Cesar Velasquez" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-purple-500" required>
                        <p class="text-xs text-gray-400 mt-1">Nombre real del usuario</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">‚òéÔ∏è Tel√©fono (Opcional)</label>
                        <input type="tel" id="form-usuario-telefono" placeholder="ej: 0990830745" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-purple-500">
                        <p class="text-xs text-gray-400 mt-1">N√∫mero de contacto del usuario</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üë®‚Äçüíº Rol del Usuario</label>
                        <select id="form-usuario-rol" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-purple-500" required>
                            <option value="">-- Selecciona un rol --</option>
                            <option value="cliente">üõçÔ∏è Cliente (Solicita descargas de juegos)</option>
                            <option value="empleado">üíº Empleado (Gestiona solicitudes)</option>
                            <option value="administrador">üîê Administrador (Control total del sistema)</option>
                        </select>
                        <p class="text-xs text-gray-400 mt-1">Define los permisos del usuario</p>
                    </div>
                    <div class="flex gap-4">
                        <button type="submit" id="btn-form-usuario-submit" class="flex-1 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded font-bold">
                            Crear
                        </button>
                        <button type="button" id="cerrar-modal-usuario" class="flex-1 py-2 bg-gray-700 rounded font-bold">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para Crear/Editar Juego -->
        <div id="modal-juego" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md max-h-96 overflow-y-auto">
                <h3 class="text-2xl font-bold mb-4">Agregar Nuevo Juego</h3>
                <form id="form-juego" class="space-y-4">
                    <input type="text" id="juego-nombre" placeholder="Nombre del juego" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded" required>
                    <select id="juego-consola" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded" required>
                        <option value="">Selecciona consola</option>
                        <option value="PSP">PSP</option>
                        <option value="PS2">PS2</option>
                        <option value="PS3">PS3</option>
                        <option value="PS4">PS4</option>
                    </select>
                    <input type="number" id="juego-peso" placeholder="Peso (GB)" step="0.1" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded" required>
                    <textarea id="juego-descripcion" placeholder="Descripci√≥n" rows="3" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded"></textarea>
                    <input type="url" id="juego-imagen" placeholder="URL de imagen" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded">
                    <div class="flex gap-4">
                        <button type="submit" class="flex-1 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded font-bold">
                            Guardar
                        </button>
                        <button type="button" id="cerrar-modal-juego" class="flex-1 py-2 bg-gray-700 rounded font-bold">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para Gestionar Trabajo (Estado y Pago) -->
        <div id="modal-trabajo" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <h3 id="modal-trabajo-titulo" class="text-2xl font-bold mb-4">Gestionar Trabajo</h3>
                
                <div id="trabajo-info-basica" class="bg-gray-700 rounded-lg p-4 mb-6">
                    <p class="text-sm text-gray-300 mb-2"><strong>Cliente:</strong> <span id="trabajo-cliente">-</span></p>
                    <p class="text-sm text-gray-300 mb-2"><strong>Tipo:</strong> <span id="trabajo-tipo">-</span></p>
                    <p class="text-sm text-gray-300 mb-2"><strong>Estado Actual:</strong> <span id="trabajo-estado-actual">-</span></p>
                    <p class="text-sm text-gray-300"><strong>Total a Pagar:</strong> <span id="trabajo-costo-total" class="text-purple-300 font-bold">$0</span></p>
                </div>

                <form id="form-trabajo-pago" class="space-y-4">
                    <input type="hidden" id="trabajo-id-oculto">
                    
                    <!-- Cambiar Estado -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">üìä Cambiar Estado</label>
                        <select id="trabajo-nuevo-estado" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-purple-500">
                            <option value="">-- Sin cambios --</option>
                            <option value="pendiente">üîµ Pendiente</option>
                            <option value="en_progreso">üü° En Proceso</option>
                            <option value="completado">üü¢ Completado</option>
                            <option value="cancelado">üî¥ Anulado</option>
                        </select>
                    </div>

                    <!-- Secci√≥n de Deuda Total -->
                    <div class="bg-blue-900 border border-blue-700 rounded-lg p-4">
                        <p class="text-sm font-bold text-blue-200 mb-3">üí≥ Asignar Deuda Total</p>
                        <p class="text-xs text-blue-300 mb-3">Permite establecer un nuevo total a pagar y limpiar el historial de pagos</p>
                        <div class="flex gap-2 mb-3">
                            <input type="number" id="trabajo-deuda-total" placeholder="Monto total a pagar" step="0.01" min="0" class="flex-1 px-3 py-2 bg-gray-600 border border-gray-500 rounded text-sm focus:outline-none focus:border-blue-500">
                            <button type="button" id="btn-asignar-deuda" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm font-bold transition whitespace-nowrap">
                                üîÑ Asignar
                            </button>
                        </div>
                        <button type="button" id="btn-limpiar-pagos" class="w-full px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-xs font-bold transition">
                            üóëÔ∏è Limpiar Historial de Pagos
                        </button>
                    </div>

                    <!-- Informaci√≥n de Pago -->
                    <div class="bg-gray-700 rounded-lg p-4">
                        <p class="text-sm font-bold text-gray-300 mb-3">üí∞ Informaci√≥n de Pago</p>
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <div>
                                <p class="text-xs text-gray-400">Pagado:</p>
                                <p class="text-lg font-bold text-green-400" id="trabajo-pagado">$0</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400">Pendiente:</p>
                                <p class="text-lg font-bold text-orange-400" id="trabajo-pendiente">$0</p>
                            </div>
                        </div>
                        
                        <div id="pagos-historial" class="bg-gray-800 rounded p-2 mb-3 max-h-40 overflow-y-auto text-xs">
                            <p class="text-gray-400 p-2">Historial de pagos</p>
                        </div>

                        <!-- Registrar Nuevo Pago -->
                        <div>
                            <label class="block text-xs font-semibold text-gray-300 mb-2">Registrar Nuevo Abono</label>
                            <div class="flex gap-2 mb-2">
                                <input type="number" id="trabajo-monto-pago" placeholder="Monto a pagar" step="0.01" min="0" class="flex-1 px-3 py-2 bg-gray-600 border border-gray-500 rounded text-sm focus:outline-none focus:border-green-500">
                                <button type="button" id="btn-registrar-pago" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded text-sm font-bold transition">
                                    üíµ Abonar
                                </button>
                            </div>
                            <button type="button" id="btn-pago-completo" class="w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm font-bold transition">
                                ‚úì Pagar Todo lo Restante
                            </button>
                        </div>
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button type="submit" class="flex-1 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded font-bold">
                            üíæ Guardar Cambios
                        </button>
                        <button type="button" id="cerrar-modal-trabajo" class="flex-1 py-2 bg-gray-700 rounded font-bold">
                            ‚úï Cerrar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/utilidades.js"></script>
    <script src="js/api.js"></script>
    <script src="js/autenticacion.js"></script>
    <script src="js/admin_dashboard.js"></script>
</body>
</html>
